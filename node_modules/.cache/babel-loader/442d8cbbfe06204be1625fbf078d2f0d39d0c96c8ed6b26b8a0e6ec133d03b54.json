{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { asyncRouterMap, constantRouterMap } from '@/router';\n\n/**\n * 通过meta.perms判断是否与当前用户权限匹配\n * @param perms\n * @param route\n */\nfunction hasPermission(perms, route) {\n  if (route.meta && route.meta.perms) {\n    return perms.some(perm => route.meta.perms.includes(perm));\n  } else {\n    return true;\n  }\n}\n\n/**\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\n * @param routes asyncRouterMap\n * @param perms\n */\nfunction filterAsyncRouter(routes, perms) {\n  const res = [];\n  routes.forEach(route => {\n    const tmp = {\n      ...route\n    };\n    if (tmp.children) {\n      tmp.children = filterAsyncRouter(tmp.children, perms);\n      if (tmp.children && tmp.children.length > 0) {\n        res.push(tmp);\n      }\n    } else {\n      if (hasPermission(perms, tmp)) {\n        res.push(tmp);\n      }\n    }\n  });\n  return res;\n}\nconst permission = {\n  state: {\n    routers: constantRouterMap,\n    addRouters: []\n  },\n  mutations: {\n    SET_ROUTERS: (state, routers) => {\n      state.addRouters = routers;\n      state.routers = constantRouterMap.concat(routers);\n    }\n  },\n  actions: {\n    GenerateRoutes({\n      commit\n    }, data) {\n      return new Promise(resolve => {\n        const {\n          perms\n        } = data;\n        let accessedRouters;\n        if (perms.includes('*')) {\n          accessedRouters = asyncRouterMap;\n        } else {\n          accessedRouters = filterAsyncRouter(asyncRouterMap, perms);\n        }\n        commit('SET_ROUTERS', accessedRouters);\n        resolve();\n      });\n    }\n  }\n};\nexport default permission;","map":{"version":3,"names":["asyncRouterMap","constantRouterMap","hasPermission","perms","route","meta","some","perm","includes","filterAsyncRouter","routes","res","forEach","tmp","children","length","push","permission","state","routers","addRouters","mutations","SET_ROUTERS","concat","actions","GenerateRoutes","commit","data","Promise","resolve","accessedRouters"],"sources":["F:/solution/solution/KoreaPost/koreapost/3.dispenser_vue3/src/store/modules/permission.js"],"sourcesContent":["import { asyncRouterMap, constantRouterMap } from '@/router'\n\n/**\n * 通过meta.perms判断是否与当前用户权限匹配\n * @param perms\n * @param route\n */\nfunction hasPermission(perms, route) {\n  if (route.meta && route.meta.perms) {\n    return perms.some(perm => route.meta.perms.includes(perm))\n  } else {\n    return true\n  }\n}\n\n/**\n * 递归过滤异步路由表，返回符合用户角色权限的路由表\n * @param routes asyncRouterMap\n * @param perms\n */\nfunction filterAsyncRouter(routes, perms) {\n  const res = []\n\n  routes.forEach(route => {\n    const tmp = { ...route }\n    if (tmp.children) {\n      tmp.children = filterAsyncRouter(tmp.children, perms)\n      if (tmp.children && tmp.children.length > 0) {\n        res.push(tmp)\n      }\n    } else {\n      if (hasPermission(perms, tmp)) {\n        res.push(tmp)\n      }\n    }\n  })\n\n  return res\n}\n\nconst permission = {\n  state: {\n    routers: constantRouterMap,\n    addRouters: []\n  },\n  mutations: {\n    SET_ROUTERS: (state, routers) => {\n      state.addRouters = routers\n      state.routers = constantRouterMap.concat(routers)\n    }\n  },\n  actions: {\n    GenerateRoutes({ commit }, data) {\n      return new Promise(resolve => {\n        const { perms } = data\n        let accessedRouters\n        if (perms.includes('*')) {\n          accessedRouters = asyncRouterMap\n        } else {\n          accessedRouters = filterAsyncRouter(asyncRouterMap, perms)\n        }\n        commit('SET_ROUTERS', accessedRouters)\n        resolve()\n      })\n    }\n  }\n}\n\nexport default permission\n"],"mappings":";AAAA,SAASA,cAAc,EAAEC,iBAAiB,QAAQ,UAAU;;AAE5D;AACA;AACA;AACA;AACA;AACA,SAASC,aAAaA,CAACC,KAAK,EAAEC,KAAK,EAAE;EACnC,IAAIA,KAAK,CAACC,IAAI,IAAID,KAAK,CAACC,IAAI,CAACF,KAAK,EAAE;IAClC,OAAOA,KAAK,CAACG,IAAI,CAACC,IAAI,IAAIH,KAAK,CAACC,IAAI,CAACF,KAAK,CAACK,QAAQ,CAACD,IAAI,CAAC,CAAC;EAC5D,CAAC,MAAM;IACL,OAAO,IAAI;EACb;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA,SAASE,iBAAiBA,CAACC,MAAM,EAAEP,KAAK,EAAE;EACxC,MAAMQ,GAAG,GAAG,EAAE;EAEdD,MAAM,CAACE,OAAO,CAACR,KAAK,IAAI;IACtB,MAAMS,GAAG,GAAG;MAAE,GAAGT;IAAM,CAAC;IACxB,IAAIS,GAAG,CAACC,QAAQ,EAAE;MAChBD,GAAG,CAACC,QAAQ,GAAGL,iBAAiB,CAACI,GAAG,CAACC,QAAQ,EAAEX,KAAK,CAAC;MACrD,IAAIU,GAAG,CAACC,QAAQ,IAAID,GAAG,CAACC,QAAQ,CAACC,MAAM,GAAG,CAAC,EAAE;QAC3CJ,GAAG,CAACK,IAAI,CAACH,GAAG,CAAC;MACf;IACF,CAAC,MAAM;MACL,IAAIX,aAAa,CAACC,KAAK,EAAEU,GAAG,CAAC,EAAE;QAC7BF,GAAG,CAACK,IAAI,CAACH,GAAG,CAAC;MACf;IACF;EACF,CAAC,CAAC;EAEF,OAAOF,GAAG;AACZ;AAEA,MAAMM,UAAU,GAAG;EACjBC,KAAK,EAAE;IACLC,OAAO,EAAElB,iBAAiB;IAC1BmB,UAAU,EAAE;EACd,CAAC;EACDC,SAAS,EAAE;IACTC,WAAW,EAAEA,CAACJ,KAAK,EAAEC,OAAO,KAAK;MAC/BD,KAAK,CAACE,UAAU,GAAGD,OAAO;MAC1BD,KAAK,CAACC,OAAO,GAAGlB,iBAAiB,CAACsB,MAAM,CAACJ,OAAO,CAAC;IACnD;EACF,CAAC;EACDK,OAAO,EAAE;IACPC,cAAcA,CAAC;MAAEC;IAAO,CAAC,EAAEC,IAAI,EAAE;MAC/B,OAAO,IAAIC,OAAO,CAACC,OAAO,IAAI;QAC5B,MAAM;UAAE1B;QAAM,CAAC,GAAGwB,IAAI;QACtB,IAAIG,eAAe;QACnB,IAAI3B,KAAK,CAACK,QAAQ,CAAC,GAAG,CAAC,EAAE;UACvBsB,eAAe,GAAG9B,cAAc;QAClC,CAAC,MAAM;UACL8B,eAAe,GAAGrB,iBAAiB,CAACT,cAAc,EAAEG,KAAK,CAAC;QAC5D;QACAuB,MAAM,CAAC,aAAa,EAAEI,eAAe,CAAC;QACtCD,OAAO,CAAC,CAAC;MACX,CAAC,CAAC;IACJ;EACF;AACF,CAAC;AAED,eAAeZ,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}